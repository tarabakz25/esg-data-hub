# ESG Data Hub ユーザーマニュアル

## 目次

1. [はじめに](#はじめに)
2. [システム概要](#システム概要)
3. [初期セットアップ](#初期セットアップ)
4. [ログインとユーザー管理](#ログインとユーザー管理)
5. [主要機能の使い方](#主要機能の使い方)
6. [ダッシュボード](#ダッシュボード)
7. [データ管理](#データ管理)
8. [KPIマッピング](#kpiマッピング)
9. [コンプライアンスチェック](#コンプライアンスチェック)
10. [通知システム](#通知システム)
11. [データカタログ](#データカタログ)
12. [レポート生成](#レポート生成)
13. [トラブルシューティング](#トラブルシューティング)
14. [FAQ](#faq)

---

## はじめに

ESG Data Hubは、企業のESG（環境・社会・ガバナンス）データを効率的に管理・分析するためのWebアプリケーションです。このマニュアルでは、システムの使い方を詳しく説明します。

### 主な利点

- **作業効率向上**: ESG資料作成工数を50%以上削減
- **データ品質向上**: 自動マッピングとコンプライアンスチェック
- **監査対応**: 完全な変更履歴とトレーサビリティ
- **リアルタイム監視**: KPIの欠損やアラートを即座に検知

---

## システム概要

### アクセス情報

- **URL**: http://localhost:3000（開発環境）
- **対応ブラウザ**: Chrome、Firefox、Safari、Edge（最新版）
- **必要な権限**: インターネット接続、JavaScriptの有効化

### システム要件

- モダンブラウザ（2年以内のバージョン）
- 安定したインターネット接続
- 画面解像度: 1024×768以上推奨

---

## 初期セットアップ

### 1. 開発者・管理者向けセットアップ

#### システム要件
- Node.js 18以上
- PostgreSQL 14以上
- Git

#### 環境構築手順

```bash
# 1. リポジトリのクローン
git clone <repository-url>
cd esg-data-hub

# 2. 依存関係のインストール
npm install

# 3. 環境変数の設定
cp .env.example .env.local
# .env.localファイルを編集して必要な環境変数を設定

# 4. データベースのセットアップ
npm run db:generate
npm run db:push

# 5. 初期データの投入
npm run db:seed

# 6. 管理者ユーザーの作成
npm run admin:create

# 7. 開発サーバーの起動
npm run dev
```

### 2. 初回ログイン

1. ブラウザで `http://localhost:3000` にアクセス
2. 作成した管理者アカウントでログイン
3. ダッシュボードが表示されれば setup完了

---

## ログインとユーザー管理

### ログイン方法

1. ホームページの「ログイン」ボタンをクリック
2. メールアドレスとパスワードを入力
3. 「ログイン」ボタンをクリック

### ユーザーロールと権限

| ロール | 権限内容 | 主な使用者 |
|--------|----------|------------|
| **admin** | • 全機能への完全アクセス<br/>• ユーザー管理<br/>• システム設定変更<br/>• データ削除・承認 | システム管理者 |
| **ir_manager** | • データ管理<br/>• レポート作成<br/>• ワークフロー承認<br/>• KPI設定 | IR部・経営企画部マネージャー |
| **auditor** | • データ閲覧<br/>• 監査機能<br/>• 監査レポート作成<br/>• 証跡確認 | 監査室・監査法人 |
| **viewer** | • データとレポートの閲覧のみ<br/>• ダッシュボード表示 | 一般ユーザー・株主 |

### 新しいユーザーの追加（管理者のみ）

管理者は以下の方法でユーザーを追加できます：

1. **UI経由**（今後実装予定）
2. **API経由**:
```bash
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "name": "山田太郎",
    "password": "securepassword123",
    "role": "ir_manager",
    "department": "IR部"
  }'
```

---

## 主要機能の使い方

### ナビゲーション

ログイン後、左側のサイドバーから以下の機能にアクセスできます：

- **🏠 ダッシュボード**: 全体の概要とKPI状況
- **📊 データ管理**: ファイルアップロードとデータソース管理
- **🎯 KPIマッピング**: 自動マッピングと手動調整
- **✅ コンプライアンス**: 規制適合性チェック
- **📋 データカタログ**: KPIとデータソースの検索
- **📄 レコード**: データ履歴と変更追跡
- **📮 通知**: アラートと重要な更新
- **⚙️ 設定**: ユーザー設定とシステム設定

---

## ダッシュボード

### 概要表示

ダッシュボードでは以下の情報が一目で確認できます：

1. **KPI概要カード**
   - 総KPI数
   - 完了率
   - 欠損数
   - 最終更新日時

2. **リアルタイムチャート**
   - KPIトレンド
   - データ品質指標
   - 部門別進捗

3. **重要アラート**
   - 欠損KPI
   - 期限切れデータ
   - コンプライアンス警告

### ダッシュボードの操作

- **期間フィルター**: 右上のドロップダウンで表示期間を変更
- **チャート詳細**: グラフをクリックすると詳細画面へ遷移
- **クイックアクション**: 各カードから関連する機能へ直接アクセス

---

## データ管理

### ファイルアップロード

#### 対応ファイル形式
- CSV (.csv)
- Excel (.xlsx, .xls)
- JSON (.json)

#### アップロード手順

1. **「データ管理」→「アップロード」**を選択
2. **「ファイルを選択」**ボタンをクリック
3. ファイルを選択し、**「アップロード開始」**をクリック
4. アップロード進行状況を確認
5. 完了後、自動でマッピング画面へ遷移

#### アップロード後の自動処理

1. **ファイル解析**: 構造とデータ型の自動検出
2. **サンプリング**: 代表的なデータ値の抽出
3. **埋め込み生成**: AI による意味理解
4. **初期マッピング**: 既存KPIとの類似度計算

### データソース管理

#### データソース一覧

**「データ管理」→「ソース管理」**で以下を確認できます：

- アップロード済みファイル一覧
- 各ファイルの処理状況
- データ品質スコア
- 最終更新日時

#### データソースの操作

- **詳細表示**: ファイル名をクリック
- **再処理**: エラーがあった場合の再実行
- **削除**: 不要なデータソースの削除（管理者のみ）
- **履歴表示**: 変更履歴の確認

---

## KPIマッピング

### 自動マッピング機能

ESG Data Hubの最大の特徴である自動マッピング機能について説明します。

#### 自動マッピングの仕組み

1. **列名分析**: CSVの列名を解析
2. **サンプル値分析**: 実際のデータ値を確認
3. **AI判定**: 既存のKPI定義と意味的類似度を計算
4. **マッピング提案**: 信頼度と共に候補を提示

#### マッピングウィザードの使用方法

1. **ファイルアップロード完了後、自動でマッピング画面が表示**
2. **各列に対するマッピング候補を確認**
   - 🟢 高信頼度（80%以上）: 緑色で表示
   - 🟡 中信頼度（50-79%）: 黄色で表示
   - 🔴 低信頼度（50%未満）: 赤色で表示

3. **マッピングの調整**
   - ドロップダウンから正しいKPIを選択
   - 新しいKPIを作成（必要に応じて）
   - マッピングをスキップ

4. **単位換算の確認**
   - 自動検出された単位を確認
   - 必要に応じて手動で修正

5. **「マッピング確定」**をクリック

### 手動マッピング

#### KPIの新規作成

1. **「新しいKPIを作成」**をクリック
2. 以下の情報を入力：
   - **KPI名**: わかりやすい名称
   - **カテゴリ**: 環境・社会・ガバナンス
   - **単位**: kg-CO2, MWh, 人 など
   - **説明**: KPIの詳細説明

3. **「作成」**をクリック

#### マッピングの修正

既存のマッピングを修正する場合：

1. **「データ管理」→「マッピング履歴」**を選択
2. 修正したいファイルを選択
3. **「マッピング編集」**をクリック
4. 必要な修正を実行
5. **「更新」**をクリック

---

## コンプライアンスチェック

### 対応規制基準

現在、以下の規制基準に対応しています：

- **ISSB** (International Sustainability Standards Board)
- **CSRD** (Corporate Sustainability Reporting Directive)  
- **GRI** (Global Reporting Initiative)
- **その他**: カスタム基準の追加可能

### 自動コンプライアンスチェック

#### チェック実行タイミング

- 新しいデータアップロード時
- 月次自動実行（毎月1日）
- 手動実行（必要に応じて）

#### チェック結果の確認

1. **「コンプライアンス」**メニューを選択
2. **最新チェック結果**が表示されます：
   - 🟢 **適合**: すべてのKPIが揃っている
   - 🟡 **警告**: 一部KPIが不足
   - 🔴 **不適合**: 重要KPIが大幅に不足

#### 欠損KPIの対応

**欠損が検出された場合：**

1. **詳細レポートを確認**
   - 欠損KPIリスト
   - 重要度レベル
   - 期限情報

2. **対応アクションを実行**
   - データの追加アップロード
   - 既存データの修正
   - 代替KPIの設定

3. **再チェック実行**
   - 修正後、手動で再チェック
   - 結果の確認

### 手動チェック実行

1. **「コンプライアンス」→「チェック実行」**を選択
2. **対象期間を設定**（例：2024年度）
3. **規制基準を選択**（ISSB、CSRD等）
4. **「チェック開始」**をクリック
5. **結果レポートを確認**

---

## 通知システム

### 通知の種類

| 通知タイプ | 説明 | 優先度 |
|------------|------|--------|
| **データアップロード完了** | ファイル処理の完了通知 | 低 |
| **マッピング要確認** | 自動マッピングの信頼度が低い場合 | 中 |
| **コンプライアンス警告** | KPIの欠損やエラー | 高 |
| **期限アラート** | 報告期限が近づいている場合 | 高 |
| **システムメンテナンス** | 定期メンテナンスの予告 | 中 |

### 通知の確認方法

#### ヘッダー通知

1. **ベルアイコン**をクリック
2. **未読通知一覧**を確認
3. **通知をクリック**すると詳細画面へ遷移
4. **すべて既読**で一括既読化

#### 通知詳細画面

1. **「通知」**メニューを選択
2. **フィルター機能**で通知を絞り込み：
   - 未読/既読
   - 通知タイプ
   - 日付範囲
   - 優先度

3. **一括操作**：
   - 複数選択して既読化
   - 重要な通知にスター付け
   - 不要な通知を削除

### 通知設定

#### 個人設定

1. **右上のユーザーアイコン**→**「設定」**を選択
2. **「通知設定」**タブを選択
3. **受信する通知タイプを選択**：
   - メール通知のON/OFF
   - 通知タイプ別の設定
   - 通知頻度の調整

#### Slack連携（管理者設定）

重要なアラートをSlackに送信できます：

1. Slack Webhook URLを環境変数に設定
2. 送信する通知レベルを設定
3. チャンネルとメンション設定

---

## データカタログ

### KPI検索

#### 基本検索

1. **「カタログ」**メニューを選択
2. **検索ボックス**にキーワードを入力
3. **フィルター**で絞り込み：
   - カテゴリ（環境/社会/ガバナンス）
   - 単位
   - データソース
   - 更新日

#### 高度な検索

**詳細検索フォーム**では以下の条件で検索できます：

- **KPI名の部分一致**
- **説明文の全文検索**  
- **数値範囲での絞り込み**
- **複数条件の組み合わせ**

### KPI詳細情報

各KPIをクリックすると以下の情報が表示されます：

#### 基本情報
- KPI名と説明
- カテゴリ分類
- 単位と値域
- 作成日・更新日

#### データ履歴
- 時系列グラフ
- 統計情報（平均、最大、最小）
- データ品質スコア

#### 関連情報
- 同じカテゴリのKPI
- 類似KPIの提案
- 参照元データソース

### データソース管理

#### ソース一覧

**「カタログ」→「データソース」**で確認できる情報：

- アップロード済みファイル
- 各ソースの KPI カバレッジ
- データ品質評価
- 最終更新状況

#### ソース詳細

各データソースの詳細画面では：

- **含まれるKPI一覧**
- **データ品質レポート**
- **処理履歴**
- **エラーログ**

---

## レポート生成

### 対応出力形式

- **PDF**: 印刷用レポート
- **Excel**: データ分析用
- **CSV**: システム連携用
- **XBRL**: 規制報告用（今後対応）

### レポート作成手順

#### 標準レポート

1. **「レポート」**メニューを選択
2. **レポートテンプレート**を選択：
   - ISSB準拠レポート
   - CSRD準拠レポート
   - カスタムレポート

3. **対象期間を設定**
4. **「生成開始」**をクリック
5. **ダウンロードリンク**から取得

#### カスタムレポート

1. **「カスタムレポート作成」**を選択
2. **含めるKPIを選択**
3. **表示形式を設定**：
   - 表形式
   - グラフ形式
   - 混在形式

4. **フィルター条件を設定**
5. **プレビュー確認**
6. **「レポート生成」**をクリック

### レポート履歴

**「レポート」→「履歴」**で以下を確認できます：

- 過去に生成したレポート一覧
- 生成日時と対象期間
- ダウンロード状況
- 再生成ボタン

---

## トラブルシューティング

### よくある問題と解決方法

#### 1. ファイルアップロードが失敗する

**症状**: ファイル選択後、アップロードが進まない

**原因と対策**:
- **ファイルサイズ**: 100MB以上のファイルは分割してアップロード
- **ファイル形式**: 対応形式（CSV、Excel、JSON）か確認
- **ネットワーク**: 接続が安定しているか確認
- **権限**: アップロード権限があるロールか確認

#### 2. マッピングの精度が低い

**症状**: 自動マッピングで正しいKPIが提案されない

**対策**:
- **列名の改善**: より具体的で標準的な列名を使用
- **サンプルデータ**: 代表的な値が含まれているか確認
- **手動調整**: 初回は手動でマッピングを行い、学習データを増やす

#### 3. ログインできない

**症状**: 正しい認証情報でもログインが失敗する

**対策**:
- **ブラウザキャッシュ**: キャッシュとCookieをクリア
- **パスワード**: 大文字小文字、特殊文字を確認
- **アカウント状態**: 管理者にアカウント状態を確認依頼
- **ブラウザ**: 別のブラウザで試行

#### 4. 表示が遅い・重い

**症状**: ページの読み込みが遅い

**対策**:
- **データ量**: 大量データの場合は期間を絞って表示
- **ブラウザ**: 不要なタブを閉じる
- **ネットワーク**: 接続速度を確認
- **キャッシュ**: ブラウザの再読み込み（Ctrl+F5）

### ログの確認方法

#### ブラウザの開発者ツール

1. **F12キー**で開発者ツールを開く
2. **Console**タブでエラーメッセージを確認
3. **Network**タブでAPI通信エラーを確認

#### システムログ（管理者のみ）

```bash
# アプリケーションログ
npm run logs

# データベースログ
npm run db:logs

# エラーログのみ抽出
npm run logs:error
```

### サポート連絡先

問題が解決しない場合は、以下の情報と共にサポートに連絡してください：

- **発生日時**
- **ユーザーアカウント**
- **ブラウザとバージョン**
- **実行していた操作**
- **エラーメッセージ（あれば）**
- **スクリーンショット**

---

## FAQ

### 一般的な質問

#### Q: システムの推奨利用時間はありますか？
A: 24時間利用可能ですが、毎日午前2-3時（JST）にメンテナンスウィンドウがあります。重要な作業は他の時間帯に実行することを推奨します。

#### Q: 複数人で同時に同じデータを編集できますか？
A: はい。ただし、競合が発生した場合は後から保存したユーザーに警告が表示され、変更の確認が求められます。

#### Q: データの削除は可能ですか？
A: 管理者権限があれば可能です。ただし、削除したデータは監査ログに記録され、一定期間は復旧可能です。

### データ関連

#### Q: アップロードできるファイルサイズの上限は？
A: 現在100MBまでです。それを超える場合は、ファイルを分割するか、管理者に相談してください。

#### Q: 過去のバージョンのデータに戻すことはできますか？
A: はい。各データには完全なバージョン履歴が保持されており、任意の時点に戻すことができます。

#### Q: APIでのデータ連携は可能ですか？
A: はい。REST APIとGraphQLの両方に対応しています。API仕様書は管理者から入手してください。

### セキュリティ

#### Q: データはどこに保存されますか？
A: データは暗号化されてPostgreSQLデータベースに保存され、ファイルはS3互換ストレージに保存されます。

#### Q: 外部からのアクセスは制限されていますか？
A: はい。VPN経由でのアクセスやIPアドレス制限が可能です（設定により）。

#### Q: パスワードの変更方法は？
A: 右上のユーザーアイコン→「設定」→「パスワード変更」から実行できます。

### 機能について

#### Q: 新しい規制基準に対応できますか？
A: はい。システムは拡張可能な設計になっており、新しい規制基準の追加は比較的容易です。

#### Q: カスタムKPIの作成は可能ですか？
A: はい。組織独自のKPIを定義し、標準KPIと同様に管理できます。

#### Q: 多言語対応の予定はありますか？
A: 現在は日本語のみですが、将来的に英語対応を予定しています。

---

## まとめ

ESG Data Hubは、ESGデータ管理の複雑さを解決し、効率的な報告業務を実現するための強力なツールです。このマニュアルに従って操作することで、以下の効果が期待できます：

✅ **作業効率の大幅向上** - 従来の手作業から自動化への移行  
✅ **データ品質の向上** - 一貫した基準とチェック機能  
✅ **コンプライアンス確保** - 各種規制への確実な対応  
✅ **監査対応の簡素化** - 完全なトレーサビリティ

ご不明な点がございましたら、このマニュアルのトラブルシューティングセクションを参照するか、システム管理者までお問い合わせください。

---

*このマニュアルは、ESG Data Hub v0.1.0に基づいて作成されています。機能の追加や変更に伴い、随時更新される予定です。* 